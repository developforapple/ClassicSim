#include "ProtectionPaladin.h"
#include <QObject>
#include "Paladin.h"
#include "PaladinSpells.h"
#include "TalentStatIncrease.h"

ProtectionPaladin::ProtectionPaladin(Paladin* paladin) :
    TalentTree(QObject::tr("Protection"), "Assets/paladin/paladin_protection.jpg"), paladin(paladin), spells(static_cast<PaladinSpells*>(paladin->get_spells())) {
    talent_names_to_locations = {
        {QObject::tr("Improved Devotion Aura"), "1ML"},
        {QObject::tr("Redoubt"), "1MR"},
        {QObject::tr("Precision"), "2LL"},
        {QObject::tr("Guardian's Favor"), "2ML"},
        {QObject::tr("Toughness"), "2RR"},
        {QObject::tr("Blessing of Kings"), "3LL"},
        {QObject::tr("Improved Righteous Fury"), "3ML"},
        {QObject::tr("Shield Specialization"), "3MR"},
        {QObject::tr("Anticipation"), "3RR"},
        {QObject::tr("Improved Hammer of Justice"), "4ML"},
        {QObject::tr("Improved Concentration Aura"), "4MR"},
        {QObject::tr("Blessing of Sanctuary"), "5ML"},
        {QObject::tr("Reckoning"), "5MR"},
        {QObject::tr("One-Handed Weapon Specialization"), "6MR"},
        {QObject::tr("Holy Shield"), "7ML"},
    };

    QMap<QString, Talent*> tier1 {{"1ML", new Talent(paladin, this, QObject::tr("Improved Devotion Aura"), "1ML", "Assets/spell/Spell_holy_devotionaura.png", 5,
                                                     QObject::tr("Increases the armor bonus of your Devotion Aura by %1%."),
                                                     QVector<QPair<unsigned, unsigned>> {{5, 5}})},
                                  {"1MR", new Talent(paladin, this, QObject::tr("Redoubt"), "1MR", "Assets/ability/Ability_defend.png", 5,
                                                     QObject::tr("Increases your chance to block attacks with your shield by %1% after being the victim of a "
                                                     "critical strike. Lasts 10 sec or 5 blocks."),
                                                     QVector<QPair<unsigned, unsigned>> {{6, 6}})}};
    add_talents(tier1);

    QMap<QString, Talent*> tier2 {{"2ML", new Talent(paladin, this, QObject::tr("Guardian's Favor"), "2ML", "Assets/spell/Spell_holy_sealofprotection.png", 2,
                                                     QObject::tr("Reduces the cooldown of your Blessing of Protection by %1 sec and increases the duration of "
                                                     "your Blessing of Freedom by %2 sec."),
                                                     QVector<QPair<unsigned, unsigned>> {{60, 60}, {3, 3}})},
                                  {"2RR", new Talent(paladin, this, QObject::tr("Toughness"), "2RR", "Assets/spell/Spell_holy_devotion.png", 5,
                                                     QObject::tr("Increases the armor value from items by %1%"), QVector<QPair<unsigned, unsigned>> {{2, 2}})}};
    add_precision(tier2);
    add_talents(tier2);

    QMap<QString, Talent*> tier3 {{"3LL", new Talent(paladin, this, QObject::tr("Blessing of Kings"), "3LL", "Assets/spell/Spell_magic_magearmor.png", 1,
                                                     QObject::tr("Places a Blessing on the friendly target, increasing total stats by 10% for 5 min. Players may "
                                                     "only have one Blessing on them per Paladin at any one time."),
                                                     QVector<QPair<unsigned, unsigned>>())},
                                  {"3ML", new Talent(paladin, this, QObject::tr("Improved Righteous Fury"), "3ML", "Assets/spell/Spell_holy_sealoffury.png", 3,
                                                     QObject::tr("Increases the amount of threat generated by your Righteous Fury spell by %1%."),
                                                     QVector<QPair<unsigned, unsigned>> {{16, 17}})},
                                  {"3MR", new Talent(paladin, this, QObject::tr("Shield Specialization"), "3MR", "Assets/items/Inv_shield_06.png", 3,
                                                     QObject::tr("Increases the amount of damage absorbed by your shield by %1%."),
                                                     QVector<QPair<unsigned, unsigned>> {{10, 10}})},
                                  {"3RR", new Talent(paladin, this, QObject::tr("Anticipation"), "3RR", "Assets/spell/Spell_nature_mirrorimage.png", 5,
                                                     QObject::tr("Increases your Defense skill by %1."), QVector<QPair<unsigned, unsigned>> {{2, 2}})}};
    add_talents(tier3);

    QMap<QString, Talent*> tier4 {{"4ML", new Talent(paladin, this, QObject::tr("Improved Hammer of Justice"), "4ML", "Assets/spell/Spell_holy_sealofmight.png", 3,
                                                     QObject::tr("Decreases the cooldown of your Hammer of Justice spell by %1 sec."),
                                                     QVector<QPair<unsigned, unsigned>> {{5, 5}})},
                                  {"4MR", new Talent(paladin, this, QObject::tr("Improved Concentration Aura"), "4MR", "Assets/spell/Spell_holy_mindsooth.png", 3,
                                                     QObject::tr("Increases the effect of your Concentration Aura by an additional %1% and gives all group "
                                                     "members affected by the aura an additional %2% chance to resist Silence and Interrupt effects."),
                                                     QVector<QPair<unsigned, unsigned>> {{5, 5}, {5, 5}})}};
    add_talents(tier4);

    QMap<QString, Talent*> tier5 {{"5ML", new Talent(paladin, this, QObject::tr("Blessing of Sanctuary"), "5ML", "Assets/spell/Spell_nature_lightningshield.png", 1,
                                                     QObject::tr("Places a Blessing on the friendly target, reducing damage dealt from all sources by up to 10 "
                                                     "for 5 min. In addition, when the target blocks a melee attack the attacker will take 14 Holy "
                                                     "damage. Players may only have one Blessing on them per Paladin at any one time."),
                                                     QVector<QPair<unsigned, unsigned>>())},
                                  {"5MR", new Talent(paladin, this, QObject::tr("Reckoning"), "5MR", "Assets/spell/Spell_holy_blessingofstrength.png", 5,
                                                     QObject::tr("Gives you a %1% chance to gain an extra attack after being the victim of a critical strike."),
                                                     QVector<QPair<unsigned, unsigned>> {{20, 20}})}};
    add_talents(tier5);

    QMap<QString, Talent*> tier6 {};
    add_one_handed_weapon_specialization(tier6);
    add_talents(tier6);

    QMap<QString, Talent*> tier7 {
        {"7ML", new Talent(paladin, this, QObject::tr("Holy Shield"), "7ML", "Assets/spell/Spell_holy_blessingofprotection.png", 1,
                           QObject::tr("Increases chance to block by 30% for 10 sec, and deals 65 Holy damage for each attack blocked while active. Damage "
                           "caused by Holy Shield causes 20% additional threat. Each block expends a charge. 4 charges."),
                           QVector<QPair<unsigned, unsigned>>())}};
    add_talents(tier7);

    talents["1MR"]->talent->set_bottom_child(talents["3MR"]->talent);
    talents["3MR"]->talent->set_parent(talents["1MR"]->talent);

    talents["5ML"]->talent->set_bottom_child(talents["7ML"]->talent);
    talents["7ML"]->talent->set_parent(talents["5ML"]->talent);
}

void ProtectionPaladin::add_precision(QMap<QString, Talent*>& talent_tier) {
    auto talent = new TalentStatIncrease(paladin, this, QObject::tr("Precision"), "2LL", "Assets/ability/Ability_rogue_ambush.png", 3,
                                         QObject::tr("Increases your chance to hit with melee weapons by %1%."), QVector<QPair<unsigned, unsigned>> {{1, 1}},
                                         QVector<QPair<TalentStat, unsigned>> {{TalentStat::MeleeHit, 100}, {TalentStat::RangedHit, 100}});

    add_talent_to_tier(talent_tier, talent);
}

void ProtectionPaladin::add_one_handed_weapon_specialization(QMap<QString, Talent*>& talent_tier) {
    auto talent = new TalentStatIncrease(paladin, this, QObject::tr("One-Handed Weapon Specialization"), "6MR", "Assets/items/Inv_sword_20.png", 5,
                                         QObject::tr("Increases the damage you deal with One-Handed Melee weapons by %1%."),
                                         QVector<QPair<unsigned, unsigned>> {{2, 2}},
                                         QVector<QPair<TalentStat, unsigned>> {{TalentStat::OneHandMeleeDmg, 2}});

    add_talent_to_tier(talent_tier, talent);
}
