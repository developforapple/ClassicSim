<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<rotation class="Warrior" name="Fury Rage conservative stance dancing" name_zh="双持狂暴战（打压制前泄怒）" attack_mode="melee">
    <!--
    Spell evaluation:
    <cast_if name="">
    Must specify a name. Is attempted to be cast if specified conditions are met. There is an implied condition that spell must be castable that exact instant.
    This implied condition evaluates to true if resources >= resource cost, not on gcd (if ability restricted to gcd), not on spell cd, in correct stance/form, etc.
    If no conditions are specified only this implied condition is used.

    Logic operators ("and"/"or") must be used to chain conditions if a <cast_if> has more than a single condition.


    Built-in variables:
    melee_attacking - whether player is melee attacking.
    target_health - percentage hp remaining.
    time_remaining_encounter - time remaining in encounter.
    time_remaining_execute - time remaining to Execute phase.
    time_remaining_mh_swing - time remaining to next MH swing.

    State:
    In order to simplify conditions variables can be used to implement state.
    This is mostly (only?) useful for non-instant attacks, such as Heroic Strike.

    TODO: Consider how to set trigger to change variable value.

    Order is significant in this file, first <cast_if> has highest priority.
    Remember to evaluate non-GCD abilities first, as the rotation is re-run if player was not put on GCD by (non-empty) action.

    rotation = QVector<Action*>
    Action* action = rotation.takeFirstTrue();
    while (action != nullptr) {
        action->perform();
        action = rotation.takeFirstTrue();
    }

    -->
    <description>
    <!-- TODO: When displaying description, prepend to this string something along the lines of:
    "NOTE: The following description was manually written, double check that the rotation is closely matching the description."

    qDebug() << rotation.dump_prerequisites();

    Then perhaps add a simplified output in python-style of what the rotation has been interpreted to be.

    for (int i = 0; i < actions.size(); ++i) {
        qDebug() << actions[i]->dump_printable_conditions();
    }
    -->
    <en>A rotation that attempts to heavily conserve rage when stance dancing.

    This implies fewer Overpowers are cast since Overpower is more likely to not always be consumed before proccing again,
    but it also implies less rage lost from stance dancing.

    Better for lower item levels due to less rage available, and thus rage conservation is more important.</en>
    <zh>双持狂暴战输出循环，姿态切换时尽量节约怒气。
    意味着少打了一些压制，因为可能再次触发压制前此次没有被消耗掉，但也意味着切换姿态时更少的怒气损失。
    装备物品等级较低时比较好用，因为可以获得的怒气更少，所以需要节省怒气。
    </zh>
    </description>

    <precombat_actions>
        <spell name="Bloodrage" name_zh="血性狂暴"/>
        <spell name="Battle Shout" name_zh="战斗怒吼"/>
        <spell name="Berserker Stance" name_zh="狂暴姿态"/>
    </precombat_actions>

    <cast_if name="Berserker Rage" name_zh="狂暴之怒">
        <en>resource "Rage" less 50</en>
    </cast_if>

    <cast_if name="Battle Shout" name_zh="战斗怒吼">
        <en>buff_duration "Battle Shout" less 3
            or variable "time_remaining_execute" less 10
            and variable "time_remaining_execute" greater 0
            and buff_duration "Battle Shout" less 45</en>
        <zh>buff_duration "战斗怒吼" less 3
            or variable "time_remaining_execute" less 10
            and variable "time_remaining_execute" greater 0
            and buff_duration "战斗怒吼" less 45</zh>
    </cast_if>

    <!-- General heroic strike usage -->
    <cast_if name="Heroic Strike" name_zh="英勇打击">
        <en>variable "time_remaining_execute" greater 3
            and resource "Rage" greater 50</en>
    </cast_if>

    <!-- Special heroic strike usage: attempt to dump rage when Overpower is up. -->
    <cast_if name="Heroic Strike" name_zh="英勇打击">
        <en>variable "time_remaining_execute" greater 3
            and resource "Rage" greater 30
            and buff_duration "Overpower" greater 3
            and buff_duration "Battle Stance" is false
            and spell "Mainhand Attack" less 1.5</en>
        <zh>variable "time_remaining_execute" greater 3
            and resource "Rage" greater 30
            and buff_duration "压制" greater 3
            and buff_duration "战斗姿态" is false
            and spell "主手攻击" less 1.5</zh>

        <!--let "dumping_rage_before_stancing" = true-->
    </cast_if>
    
    <cast_if name="Manual Crowd Pummeler" name_zh="手动惩戒器"/>

    <cast_if name="Kiss of the Spider" name_zh="蜘蛛之吻">
        <en>buff_duration "Death Wish" is true</en>
        <zh>buff_duration "死亡之愿" is true</zh>
    </cast_if>

    <cast_if name="Jom Gabbar" name_zh="沙虫之毒">
        <en>buff_duration "Death Wish" is true</en>
        <zh>buff_duration "死亡之愿" is true</zh>
    </cast_if>

    <cast_if name="Badge of the Swarmguard" name_zh="虫群卫士徽章">
        <en>buff_duration "Death Wish" is true</en>
        <zh>buff_duration "死亡之愿" is true</zh>
    </cast_if>

    <cast_if name="Slayer's Crest" name_zh="屠龙者的纹章">
        <en>buff_duration "Death Wish" is true</en>
        <zh>buff_duration "死亡之愿" is true</zh>
    </cast_if>

    <cast_if name="Earthstrike" name_zh="大地之击">
        <en>buff_duration "Death Wish" is true</en>
        <zh>buff_duration "死亡之愿" is true</zh>
    </cast_if>

    <cast_if name="Zandalarian Hero Medallion" name_zh="赞达拉英雄勋章">
        <en>buff_duration "Death Wish" is true</en>
        <zh>buff_duration "死亡之愿" is true</zh>
    </cast_if>

    <cast_if name="Diamond Flask" name_zh="钻石水瓶">
        <en>buff_duration "Death Wish" is true</en>
        <zh>buff_duration "死亡之愿" is true</zh>
    </cast_if>

    <cast_if name="Cloudkeeper Legplates" name_zh="踏云腿甲">
        <en>buff_duration "Death Wish" is true</en>
        <zh>buff_duration "死亡之愿" is true</zh>
    </cast_if>

    <cast_if name="Death Wish" name_zh="死亡之愿">
        <en>variable "time_remaining_encounter" less 33
            or variable "time_remaining_execute" less 3
            or variable "time_remaining_execute" greater 180</en>
    </cast_if>

    <cast_if name="Recklessness" name_zh="鲁莽">
        <en>variable "time_remaining_execute" less 0
            or variable "time_remaining_encounter" less 20</en>
    </cast_if>

    <cast_if name="Blood Fury" name_zh="血性狂暴（种族特长）">
        <en>variable "time_remaining_execute" less 0
            and resource "Rage" less 50
            or variable "time_remaining_execute" greater 120</en>
    </cast_if>

    <cast_if name="Berserking" name_zh="狂暴">
        <en>variable "time_remaining_execute" less 0
            and resource "Rage" less 50
            or variable "time_remaining_execute" greater 180</en>
    </cast_if>

    <!-- Always cast Execute if available (implicit condition). -->
    <cast_if name="Execute" name_zh="斩杀"/>

    <!-- Always cast Bloodthirst if not in Execute range. -->
    <cast_if name="Bloodthirst" name_zh="嗜血">
        <en>variable "time_remaining_execute" greater 0</en>
    </cast_if>

    <!-- Whirlwind only if Bloodthirst on cooldown and not in Execute phase. -->
    <cast_if name="Whirlwind" name_zh="旋风斩">
        <en>spell "Bloodthirst" greater 1.5
            and variable "time_remaining_execute" greater 0</en>
        <zh>spell "嗜血" greater 1.5
            and variable "time_remaining_execute" greater 0</zh>
    </cast_if>

    <!-- Always cast Overpower if available. The implied condition checks that player is in correct stance, Overpower is active, etc. -->
    <cast_if name="Overpower" name_zh="压制"/>

    <cast_if name="Hamstring" name_zh="断筋">
        <en>spell "Bloodthirst" greater 1.5
            and variable "time_remaining_execute" greater 0
            and buff_duration "Overpower" is false
            and resource "Rage" greater 50</en>
        <zh>spell "嗜血" greater 1.5
            and variable "time_remaining_execute" greater 0
            and buff_duration "压制" is false
            and resource "Rage" greater 50</zh>
    </cast_if>

    <!-- Switch to Battle Stance -->
    <cast_if name="Battle Stance" name_zh="战斗姿态">
        <en>variable "time_remaining_execute" greater 5
            and buff_duration "Overpower" greater 2
            and spell "Bloodthirst" greater 3
            and resource "Rage" less 50</en>
        <zh>variable "time_remaining_execute" greater 5
            and buff_duration "压制" greater 2
            and spell "嗜血" greater 3
            and resource "Rage" less 50</zh>
        <!-- and variable "dumping_rage_before_stancing" is false -->
    </cast_if>

    <cast_if name="Berserker Stance" name_zh="狂暴姿态">
        <en>variable "time_remaining_execute" less 0
            or buff_duration "Overpower" is false</en>
        <zh>variable "time_remaining_execute" less 0
            or buff_duration "压制" is false</zh>
    </cast_if>

    <!-- Switch to dagger set before Execute (if user specified one) -->
    <!-- <cast_if name="Execute Dagger Switch">
        variable "time_remaining_execute" less 3
        and variable "execute_dagger_switch" is false

        let "execute_dagger_switch" = true
    </cast_if> -->
</rotation>